datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    module_path   = "db"
    client_format = "folder"
    output        = "../src/db/"
    provider      = "cargo prisma"
}

model User {
    id          String        @id @default(uuid())
    username    String        @unique
    tokens      ApiToken[]
    predictions Predictions[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model ApiToken {
    token  String  @id
    userId String
    name   String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id])
}

enum PredictionStatus {
    STARTING
    PROCESSING
    SUCCEEDED
    FAILED
    CANCELLED
}

model Predictions {
    id      String           @id @default(uuid())
    userId  String
    version String
    status  PredictionStatus @default(STARTING)

    input         Json
    output        Json     @default("{}")
    error         Json     @default("{}")
    logs          String?
    metrics       Json     @default("{}")
    webhookUrl    String?
    webhookFilter String[]

    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
    startedAt   DateTime?
    completedAt DateTime?

    user User @relation(fields: [userId], references: [id])
}
